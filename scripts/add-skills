#!/bin/bash

AGENT47_HOME="$HOME/.agent47"
TEMPLATES_DIR="$AGENT47_HOME/templates/skills"
HELPERS_FILE="$AGENT47_HOME/scripts/skill-utils.sh"

SKILLS_DIR="skills"
SKILL_LIST=(
  analyze
  implement
  review
  refactor
  optimize
  plan
  spec-clarify
  troubleshoot
)

echo "üß† Initializing agent skills..."

if [ ! -d "$SKILLS_DIR" ]; then
  mkdir "$SKILLS_DIR"
  echo "üìÅ Created directory: $SKILLS_DIR/"
else
  echo "üìÅ Directory already exists: $SKILLS_DIR/"
fi

for skill in "${SKILL_LIST[@]}"; do
  src="$TEMPLATES_DIR/$skill"
  dest="$SKILLS_DIR/$skill"

  if [ ! -d "$src" ]; then
    echo "‚ùå Template not found: $skill"
    continue
  fi

  if [ -d "$dest" ]; then
    echo "‚ö†Ô∏è  Skill already exists, skipping copy: $skill"
  else
    cp -R "$src" "$dest"
    echo "‚úÖ Created skill: $dest/"
  fi

  validate_skill "$dest/SKILL.md" || true
done

write_available_skills "$SKILLS_DIR" "$SKILLS_DIR/AVAILABLE_SKILLS.xml"

echo "üöÄ Skills setup complete."
if [ -f "$HELPERS_FILE" ]; then
  # shellcheck disable=SC1090
  source "$HELPERS_FILE"
else
  echo "‚ùå Helper not found: $HELPERS_FILE"
  exit 1
fi
