#!/bin/bash

AGENT47_HOME="$HOME/.agent47"
TEMPLATES_DIR="$AGENT47_HOME/templates/specs"

SPEC_DIR="specs"
SPEC_FILE="$SPEC_DIR/spec.yml"

echo "[INFO] Initializing spec..."

if [ ! -w "." ]; then
  echo "[ERR] Current directory is not writable"
  exit 1
fi

if [ ! -f "$TEMPLATES_DIR/spec.yml" ]; then
  echo "[ERR] Template not found: spec.yml"
  exit 1
fi

# Create specs directory if it doesn't exist
if [ ! -d "$SPEC_DIR" ]; then
  mkdir "$SPEC_DIR"
  echo "[OK] Created directory: specs/"
fi

# Do not overwrite existing spec
if [ -f "$SPEC_FILE" ]; then
  echo "[WARN] $SPEC_FILE already exists, skipping"
  exit 0
fi

if [ -f "$TEMPLATES_DIR/spec.yml" ]; then
  cp "$TEMPLATES_DIR/spec.yml" "$SPEC_FILE"
  echo "[OK] Created spec: $SPEC_FILE"
else
  echo "[ERR] Template not found: spec.yml"
  exit 1
fi
